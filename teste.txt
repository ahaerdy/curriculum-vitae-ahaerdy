#!/usr/bin/env bash

set -e

TMP_DIFF="$(mktemp)"
TMP_PROMPT="$(mktemp)"

# Gera o diff do staging (sem markdown)
git diff --cached > "$TMP_DIFF"

if [ ! -s "$TMP_DIFF" ]; then
  echo "Nenhuma alteração em staging (git add)."
  rm -f "$TMP_DIFF" "$TMP_PROMPT"
  exit 1
fi

cat > "$TMP_PROMPT" << 'EOF'
TAREFA:
Gerar UMA mensagem de commit.

REGRAS OBRIGATÓRIAS:
- Retorne APENAS uma única linha
- NÃO explique
- NÃO use markdown
- NÃO adicione quebras de linha
- NÃO adicione texto extra
- Máximo de 72 caracteres

FORMATO EXATO:
<tipo>(escopo opcional): <mensagem>

PADRÃO:
- Conventional Commits
- Verbo no imperativo
- Idioma: pt-BR

DIFF:
EOF

cat "$TMP_DIFF" >> "$TMP_PROMPT"

# Envia o prompt para stdout
cat "$TMP_PROMPT"

rm -f "$TMP_DIFF" "$TMP_PROMPT"
